<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>配信中一覧</title>
<style>
  body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
  .stream { 
    display: inline-block; 
    width: 300px; 
    margin: 10px; 
    background: #fff; 
    border-radius: 10px; 
    overflow: hidden; 
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    vertical-align: top;
  }
  .stream img { width: 100%; display: block; }
  .stream .info { padding: 10px; }
  .stream .info h2 { margin: 0 0 5px 0; font-size: 18px; }
  .stream .info p { margin: 0 0 5px 0; font-size: 14px; color: #555; }
  .stream .info a { color: #1f8ef1; text-decoration: none; font-weight: bold; }
</style>
</head>
<body>
<h1>配信中一覧</h1>
<div id="streamList">読み込み中...</div>

<script>

const nameMap = {
  "ziyuumama": "自由ママ",
  "osamame": "納豆",
  "tetorapamu": "天虎ぱむ",
  "cooky": "こっきー",
  "teardzn": "てぃあー",
  "pandaharry": "熊猫はりぃ",
  "hondy": "ほんでぃー",
  "tamuu": "たむう",
  "takomosher": "TAKAMOSHER",
  "katamimiusagi": "片耳うさぎ",
  "kumanokanchou": "熊の艦長",
  "lama": "LAMA",
  "macyu": "まちゅ",
  "k1rin": "K1rin",
  "h1ro": "H1ro",
  "yugiichika": "遊技イチカ",
  "rio": "りお",
  "akasa": "あかさ",
  "kamita": "神多ヘーリウ・デュシス",
};

async function loadStreams() {
  const container = document.getElementById('streamList');
  container.innerHTML = '読み込み中...';

  try {
    const res = await fetch('http://35.185.237.73:8080/live');
    if(!res.ok) throw new Error('通信失敗');
    const data = await res.json();

    if(data.length === 0){
      container.innerHTML = '現在配信中のチャンネルはありません';
      return;
    }

    container.innerHTML = '';
    data.forEach(stream => {
      const jpname = nameMap[stream.name] || stream.name;
      const div = document.createElement('div');
      div.className = 'stream';
      div.innerHTML = `
        <img src="${stream.thumbnail}" alt="${jpname}">
        <div class="info">
          <h2>${jpname}</h2>
          <p>${stream.title}</p>
          <a href="${stream.url}" target="_blank">視聴する</a>
        </div>
      `;
      container.appendChild(div);
    });
  } catch(e) {
    container.innerHTML = 'データの取得に失敗しました';
    console.error(e);
  }
}

loadStreams();
setInterval(loadStreams, 30000);
</script>
</body>
</html>
